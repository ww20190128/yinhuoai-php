# 张丹枫交接文档



[TOC]

题目采集需求：https://shimo.im/docs/Xk6dckRrtY6dvR9P

工具：https://www.jianshu.com/p/03693c5db82c



###  题目锁定

op=Question.updateQuestionStatus

请求参数：

id int 题目id

type int 1加锁 2解锁

randstr string 题目锁定修改时校验字符串



### 统计英语和语文学科高频词汇

1、查询题目并统计学科高频词汇

op=OtherStatistics.countHFWordForSub

请求参数：

subjectId int 学科id，4语文，6英语

startId int 分批次运行统计的起始查询题目id

limitNum int 每次运行统计的题目限制数量

2、获取学科高频词统计结果

op=OtherStatistics.getCountHFWordBySub

请求参数：

subjectId int 学科id，4语文，6英语



###  题组题目批量导出word本地脚本

1、查询导出数据

op=Test.exportQuestionByGroupBatch

2、执行导出

op=Test.doExportByGroup






### 帮助中心接口协议文档

**模块目录接口**

1、列表查询显示

op=HelpCenterDir.getList

请求参数

id int

parentId int 

isFirstLevel int

返回参数

id int

name string 目录名称

status int 目录状态 0正常 -1删除

index int 目录排序 

parentId int 父级目录id

parentName string 父级目录名称



2、创建

op=HelpCenterDir.create

请求参数

name string 目录名称

index int 目录排序 

parentId int 父级目录id



3、编辑

op=HelpCenterDir.edit

请求参数

id int

name string 目录名称

index int 目录排序 

parentId int 父级目录id



4、删除

op=HelpCenterDir.delete

请求参数

id int



**内容文档接口**

1、列表和详情显示

op=HelpCenterDoc.getList

请求参数

id int

dirId int 目录id

name string 文档名称

status int 文档状态

isFirstLevel int

返回参数

id int

name string 文档名称

status int 文档状态 0已发布 -1删除 1未发布

index int 文档排序

dirId int 目录id

dirName string 所属目录名称

userId int 负责人id

userName string 负责人名称

htmlPreview string html的预览链接

docPackage string 文档压缩包文件链接

video string 视频链接

createTime int 创建时间

pageInfo array

  prevDocId int 上一个文档id

  prevDocName string 上一个文档名称

  nextDocId int 下一个文档id

  nextDocName string 下一个文档名称



2、创建

op=HelpCenterDoc.create

请求参数

dirId int 目录id

name string 文档名称

htmlPreview fileresoure html文件

docPackage fileresoure 文档压缩包文件

video fileresoure 视频文件



3、编辑

op=HelpCenterDoc.edit

请求参数

id int

name string 文档名称

status int 文档状态 0发布 -1删除 1取消发布

index int 文档排序

htmlPreview fileresoure html文件

docPackage fileresoure 文档压缩包文件

video fileresoure 视频文件



4、删除

op=HelpCenterDoc.delete

请求参数

id int



目录树状列表

op=HelpCenterDir.getDirTree

请求参数

isShowDoc int 是否需要文档

返回参数

dirId int 目录id 

name string 目录名称

childList array

  dirId int 目录id 

  name string 目录名称

  docList array 文档列表 不必须

  docId int 文档id

  docName string 文档名称





CREATE TABLE `helpcenterdir` (

`id` int(11) NOT NULL AUTO_INCREMENT,

`name` varchar(64) NOT NULL DEFAULT '' COMMENT '模块名称',

`status` tinyint(4) NOT NULL DEFAULT '0' COMMENT '使用状态 0正常 -1删除',

`index` int(11) NOT NULL DEFAULT '0' COMMENT '排序',

`parentId` int(11) NOT NULL DEFAULT '0' COMMENT '父级id',

`updateTime` int(11) NOT NULL DEFAULT '0' COMMENT '更改时间',

`createTime` int(11) NOT NULL DEFAULT '0' COMMENT '创建时间',

PRIMARY KEY (`id`)

) ENGINE=InnoDB AUTO_INCREMENT=18 DEFAULT CHARSET=utf8mb4 COMMENT='帮助中心模块目录';



CREATE TABLE `helpcenterdoc` (

`id` int(11) NOT NULL AUTO_INCREMENT,

`name` varchar(255) NOT NULL DEFAULT '' COMMENT '文档名称',

`userId` int(11) NOT NULL DEFAULT '0' COMMENT '负责人id',

`status` tinyint(4) NOT NULL DEFAULT '0' COMMENT '使用状态 0正常发布 -1删除 1取消发布 ',

`index` int(11) NOT NULL DEFAULT '0' COMMENT '文档排序',

`dirId` int(11) NOT NULL DEFAULT '0' COMMENT '所属目录id',

`htmlPreview` varchar(255) NOT NULL COMMENT 'html预览链接',

`docPackage` varchar(255) NOT NULL COMMENT '文档压缩包链接',

`video` varchar(255) NOT NULL COMMENT '视频',

`fileName` varchar(255) NOT NULL COMMENT '文件原名',

`updateTime` int(11) NOT NULL DEFAULT '0' COMMENT '更新时间',

`createTime` int(11) NOT NULL DEFAULT '0' COMMENT '创建时间',

PRIMARY KEY (`id`)

) ENGINE=InnoDB AUTO_INCREMENT=19 DEFAULT CHARSET=utf8mb4 COMMENT='帮助中心内容文档';





### 词对生产接口

一、需求1-提取词对



1、提取词对的题目列表

1）op=Question.getList 请求题目编辑的接口

请求参数

2）op=ProduceWord.getList

eventType string 事件类型 question

searchSource int 搜索数据来源，只搜索词库 1

pageNum int 页码 

pageLimit int 每页数量

新增 wordStatus int 词对状态 0未提取 1已提取 2无法提取



返回参数

id	int 题目id

matter	string	题干

selections array 选项 

[

​		['mark'=>'A','value'=>''],

​	]

wordStatus int 词对状态 0未提取 1已提取 2无法提取

wordNum int 词对个数

wordGroup array	词对 

​	[

​		['wordId'=>1,'word'=>''],

​	]



2、提取词对

op=ProduceWord.getWordGroup

请求参数

questionId	 int/string		题目id 单个数字或逗号连接多个字符串

taskId	 int	任务id

返回参数：int



3、添加词对

op=ProduceWord.addWord

请求参数

questionId int 题目id

word   string   词对内容,需：连接

返回参数：int



4、编辑词对

op=ProduceWord.editWord

请求参数

questionId int 题目id

status int 词对状态 0未提取 1已提取 2无法提取

返回参数：int



5、删除词对

op=ProduceWord.deleteWord

请求参数

id  int/string		词对id 单个数字或逗号连接多个字符串

返回参数：int



6、查看词对提取的处理进度

op=ProduceWord.getInfoByDoWord

请求参数

taskId	 int	任务id	

返回参数：

total int 总处理数量

used int 已经处理的数量



二、需求2-词对贴标签

1、打标签的词对列表

op=ProduceWord.getTagWordList

请求参数

questionId	 int/string		题目id 单个数字或逗号连接多个字符串

wordId int/string		词对id 单个数字或逗号连接多个字符串

tagId int/string		标签id 单个数字或逗号连接多个字符串

wordName string 词对名

pageNum int 页码

pageLimit int 数量

返回参数：

id  int		词对id

word string 词对 

tagList string 打上的标签

questionIds string 关联的题目id



2、词对标签详情

op=ProduceWord.getWordTagInfo

请求参数

id int 词对id

返回参数：

id  int		词对id

word string 词对

tagList array 标签列表

[

['tagId'=>'','tagName'=>''],

]



3、词对加标签

op=ProduceWord.addTagToWord

请求参数

id int 词对id

tagId	 int/string		标签id 单个数字或逗号连接多个字符串

返回参数：int



4、词对移除标签

op=ProduceWord.removeWordTag

请求参数

id int 词对id

tagId	 int/string		标签id 单个数字或逗号连接多个字符串

返回参数：int



三、词对题目批量生产

op=ProduceQuestion.produceWordQuestionBatch

请求参数

knowledgeId int 知识点id

isThreeWord int	是否是三词型

beforeWordTagId int/string 前词标签id/两词型标签id	单个数字或逗号连接多个字符串

afterWordTagId int/string 后词标签id 单个数字或逗号连接多个字符串

num int 生产数量

返回参数：int



数据表操作：

CREATE TABLE `produceword` (

`id` int(11) NOT NULL AUTO_INCREMENT,

`left` varchar(255) NOT NULL DEFAULT '' COMMENT '词对左半部分',

`right` varchar(255) NOT NULL DEFAULT '' COMMENT '词对左半部分',

`source` tinyint(4) NOT NULL DEFAULT '1' COMMENT '来源类型 1题目提取 2添加录入',

`status` tinyint(4) NOT NULL DEFAULT '0' COMMENT '词对状态 0正常 -1删除',

`tagIds` varchar(255) NOT NULL DEFAULT '' COMMENT '词对标签id',

`questionIds` varchar(255) NOT NULL DEFAULT '' COMMENT '关联题目id',

`updateTime` int(11) NOT NULL DEFAULT '0' COMMENT '更新时间',

`createTime` int(11) NOT NULL DEFAULT '0' COMMENT '创建时间',

PRIMARY KEY (`id`)

) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='词对生产';



CREATE TABLE `questionword` (

`questionId` int(11) NOT NULL DEFAULT '0' COMMENT '题目id',

`wordId` int(11) NOT NULL DEFAULT '0' COMMENT '词对id',

`status` tinyint(4) NOT NULL DEFAULT '0' COMMENT '关联状态 0关联 -1删除 1提取 2无法提取 ',

`updateTime` int(11) NOT NULL DEFAULT '0' COMMENT '更新时间'

) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='题目词对关联表';



ALTER TABLE `producehistory`

ADD COLUMN `tagIds` varchar(255) NOT NULL COMMENT '标签id' AFTER `attributeValueId`;

ALTER TABLE `producehistory`

ADD COLUMN `isThreeWord` tinyint NOT NULL DEFAULT 0 COMMENT '是否是三词型' AFTER `tagIds`;



### 魔方装配接口

一、题目生成-创建生产任务

op=ProduceMagicCube.createTask

请求参数

count 	 int	 生产的题目数

cubeType	 int 	魔方阶数，三阶-3，四阶-4

complete		 int		 组合件的立方体个数，最小值12，三阶-27，四阶-64

parts	 array	 拆分件立方体个数组合,长度3，每个都不小于4

fixedFlags array 配件可变性，长度4，固定-1，可变-0



二、生产任务列表 (原有)

op=ProduceHistory.getList

请求参数：

ids		 int/string 生产记录id 多个用逗号连接

masterIds int/string 操作人id

cubeType int 	魔方阶数，三阶-3，四阶-4

complete	int 	组合件立方体个数

typeIds	 int 8

返回参数：

id int 生产记录id

type int 生产命题类型

count int 生产题目总数

master int 操作人id

userName string 操作人名称

waitNum int 待审核数量

passNum int 通过审核数量

createTime 创建时间

新增cubeInfo array

子参数：

cubeType	 int 	魔方阶数，三阶-3，四阶-4

complete		 int		 组合件的立方体个数，最小值12，三阶-27，四阶-64

parts	 string	 多个数字逗号连接，拆分件立方体个数组合,长度3，每个都不小于4

fixedFlags string  多个数字逗号连接，配件可变性，长度4，固定-1，可变-0

taskId 	int 	任务id

taskStatus int 	状态 0执行中，1已完成，2已成题，-1失败

taskInfo 	string 任务状态信息



二、刷新任务状态

op=ProduceMagicCube.getTaskStatus

无参数，请求完成后刷新页面重新调用列表接口



三、任务列表 -查看题目

1、op=ProduceMagicCube.getTaskDetail - 任务列表中状态为1时请求

请求参数：

produceId int 生产记录id



2、op=ProduceQuestion.getList - 原有的查看题目，当任务列表中状态为2时请求

参数：原有



四、题目列表-图片替换

op=ProduceMagicCube.getReplaceImages

请求参数：

questionId int 生产的题目id

返回参数：

complete array 组合件

oldImages array 原图

otherImages array 其他替换8张图

imgId int 图片id

imgUrl string 图片链接

parts array 拆分件,按顺序1,2

oldImages

otherImages

options array 选项 - 按顺序A,B,C,D

oldImages

otherImages



五、确定执行-替换题目图片

op=ProduceMagicCube.alterQuestionImage

请求参数：

questionId int 生产的题目id

type int 配件类型 1-组合件 2-拆分件1 3-拆分件2 5-选项A 6-选项B 7-选项C 8-选项D

cubeImgId int/string 选择替换的图片id



```sql
CREATE TABLE `produceMagicCube` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `cubeType` tinyint(4) NOT NULL DEFAULT '0' COMMENT '魔方阶数 三阶-3 四阶-4',
  `complete` tinyint(4) NOT NULL DEFAULT '0' COMMENT '组合件的立方体个数，最小值12，三阶-27，四阶-64',
  `parts` varchar(255) NOT NULL COMMENT '拆分件立方体个数组合,每个都不小于4',
  `fixedFlags` varchar(255) NOT NULL COMMENT '配件可变性，固定-1，可变-0',
  `taskId` int(11) NOT NULL DEFAULT '0' COMMENT '任务id',
  `produceId` int(11) NOT NULL DEFAULT '0' COMMENT '生产记录id',
  `taskStatus` tinyint(4) NOT NULL DEFAULT '0' COMMENT '状态 0执行中，1已完成，2已成题，-1失败',
  `taskInfo` varchar(255) NOT NULL COMMENT '任务状态信息',
  `createTime` int(11) NOT NULL DEFAULT '0' COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=54 DEFAULT CHARSET=utf8mb4 COMMENT='魔方装配';

CREATE TABLE `produceMagicCubeImage` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `cubeId` int(11) NOT NULL DEFAULT '0' COMMENT '配件id',
  `questionId` int(11) NOT NULL DEFAULT '0' COMMENT '题目id',
  `type` tinyint(4) NOT NULL DEFAULT '0' COMMENT '类型 1组合件 2拆分件 3选项',
  `grayImage` varchar(255) NOT NULL COMMENT '灰色图',
  `colourImage` varchar(255) NOT NULL COMMENT '彩色图',
  `imgIndex` tinyint(4) NOT NULL DEFAULT '0' COMMENT '图片序列号',
  `createTime` int(11) NOT NULL DEFAULT '0' COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1625 DEFAULT CHARSET=utf8mb4 COMMENT='魔方多角度图';

ALTER TABLE `produceQuestion` ADD COLUMN `cubeImgIds` text NULL COMMENT '魔方配件图的id组合' AFTER `imgTagIds`;
```





### crontab 定时任务

刷新魔方创建状态

*/5 * * * * nohup /bin/php /data/www/phpItemSet-YiQiSchool/Shell/main.php -h 47.104.195.241:8018 Crontab.executePre5 > /data/www/phpItemSet-YiQiSchool/Webroot/crontab.log 2>&1 &