<?php
namespace ctrl;

/**
 * 剪辑工程
 * 
 * @package ctrl
 */
class Project extends CtrlBase
{
	/**
	 * 为任务完成的回调url
	 *
	 * @return array
	 */
	public function producingJobcallback()
	{
		$params = $this->params;
	}
	
	/**
	 * 获取预览
	 *
	 * @return array
	 */
	public function getPreview()
	{
		$params = $this->params;
		if (empty($this->userId)) {
			throw new $this->exception('登录已过期，请重新登录', array('status' => 2));
		}
		$editingId = $this->paramFilter('editingId', 'intval', 0); // 剪辑Id
		if (empty($editingId)) {
			throw new $this->exception('请求参数错误');
		}
		$projectSv = \service\Project::singleton();
		return $projectSv->getPreview($this->userId, $editingId);
	}
	
	/**
	 * 创建剪辑工程
	 *
	 * @return array
	 */
	public function createProject()
	{
		$params = $this->params;
		if (empty($this->userId)) {
			throw new $this->exception('登录已过期，请重新登录', array('status' => 2));
		}
		$params = (array)$params;
		$editingId = $this->paramFilter('editingId', 'intval', 0); // 剪辑Id	
		if (empty($editingId)) {
			throw new $this->exception('请求参数错误');
		}
		$info = array(
			'type' => $this->paramFilter('type', 'intval', 1), // 1  创建剪辑 2 保存模板 3保存模板&创建剪辑 
		);
		if (!empty($params['name'])) {
			$info['name'] = $this->paramFilter('name', 'string');
		}
		if (!empty($params['numLimit'])) {
			$info['numLimit'] = $this->paramFilter('numLimit', 'intval');
			$info['numLimit'] = min($info['numLimit'], 2000);
		}
		$projectSv = \service\Project::singleton();
		return $projectSv->createProject($this->userId, $editingId, $info);
	}
	
	/**
	 * 获取剪辑工程列表
	 *
	 * @return array
	 */
	public function getProjectList()
	{

		
		
		$params = $this->params;
		if (empty($this->userId)) {
			throw new $this->exception('登录已过期，请重新登录', array('status' => 2));
		}
		$projectSv = \service\Project::singleton();
		$dataList = $projectSv->getProjectList($this->userId);
		$pageNum = $this->paramFilter('pageNum', 'intval', 1); // 页码
		$pageLimit = $this->paramFilter('pageLimit', 'intval', 20); // 每页数量限制
		// 符合条件的总条数
		$totalNum = count($dataList);
		// 分页显示
		$dataList = array_slice($dataList, ($pageNum - 1) * $pageLimit, $pageLimit);
		return array(
			'totalNum' => $totalNum,
			'list' => array_values($dataList),
		);
	}
	
	/**
	 * 删除剪辑工程
	 *
	 * @return array
	 */
	public function deleteProject()
	{
		$params = $this->params;
		if (empty($this->userId)) {
			throw new $this->exception('登录已过期，请重新登录', array('status' => 2));
		}
		$id = $this->paramFilter('id', 'string');
		if (empty($id)) {
			throw new $this->exception('请求参数错误');
		}
		$projectSv = \service\Project::singleton();
		return $projectSv->deleteProject($this->userId, $id);
	}
	
	/**
	 * 修改剪辑
	 *
	 * @return array
	 */
	public function reviseProject()
	{
		$params = $this->params;
		if (empty($this->userId)) {
			throw new $this->exception('登录已过期，请重新登录', array('status' => 2));
		}
		$params = (array)$params;
		$id = $this->paramFilter('id', 'string');
		if (empty($id)) {
			throw new $this->exception('请求参数错误');
		}
		$info = array();
		if (isset($params['name'])) {
			$info['name'] = $this->paramFilter('name', 'string');
		}	
		$projectSv = \service\Project::singleton();
		return $projectSv->reviseProject($this->userId, $id, $info);
	}
	
	/**
	 * 预览列表
	 *
	 * @return array
	 */
	public function getProjectPreviewList()
	{
		$params = $this->params;
		if (empty($this->userId)) {
			throw new $this->exception('登录已过期，请重新登录', array('status' => 2));
		}
		$id = $this->paramFilter('id', 'string');
		if (empty($id)) {
			throw new $this->exception('请求参数错误');
		}
		$pageNum = $this->paramFilter('pageNum', 'intval', 1); // 页码
		$pageLimit = $this->paramFilter('pageLimit', 'intval', 20); // 每页数量限制
		$projectSv = \service\Project::singleton();
		return $projectSv->getProjectPreviewList($this->userId, $id, $pageNum, $pageLimit);
	}
	
	/**
	 * 成品库
	 *
	 * @return array
	 */
	public function getProjectClipList()
	{
		$a = array(78736,78453,60063,60062,60061,60060,60059,60058,60057,60056,60055,60054,60053,60052,60051,60050,60049,60048,60047,60046,60045,60044,60043,56974,56973,56972,56971,56970,56969,56968,56967,56966,56965,56964,56963,56962,56961,56960,56959,56958,56957,56956,56955,56954,56936,56935,56934,56933,56932,56931,56930,56929,56928,56927,56926,56925,56924,56923,56922,56921,56920,56919,56918,56917,56916,56915,56914,56913,56912,56911,56910,56909,56908,56907,56906,56905,56904,56903,56902,56901,56900,56899,56898,56897,56896,56895,56894,56893,56892,56891,56890,56889,56888,56887,56886,56885,56884,56883,56882,56881,56880,56879,56878,56877,56876,56875,56874,56873,56872,56871,56870,56869,56578,56577,56576,56575,56574,56573,56572,56571,56555,56554,56538,56532,56513,56512,56511,56510,56508,55999,55998,55997,55996,55995,55994,55993,55992,55991,55990,55989,55988,55987,55842,55841,55840,55839,55838,55837,55836,55835,55834,55833,55832,55831,55830,55829,55828,55827,55826,55825,55824,55823,55822,55356,55355,55354,55353,55352,55351,55350,55349,55348,55347,55346,55345,55344,55343,55341,55340,55339,55338,55337,55336,55335,55334,55333,55332,55331,55330,55329,55328,55327,55326,55325,55324,55323,55322,55321,55320,55319,55318,55317,55316,55315,55314,55313,55306,55305,55304,55303,55302,55301,55300,55299,55298,55297,55296,55295,55294,55293,55292,55291,55290,55289,55288,55287,55286,55285,55284,55283,55282,55281,55280,55279,55278,55277,55276,55275,55274,55273,55272,55271,55270,55269,55268,55267,55266,55265,55264,55263,55256,55255,55254,55243,55242,55241,55240,55239,55238,55235,55234,55233,55232,55231,55230,55229,55228,55227,55226,55225,55224,55223,55222,55221,55220,55219,55218,55204,55203,55202,55201,55200,55199,55198,55197,55196,55195,55194,55193,55192,55191,55190,55189,55188,55187,55186,55185,55184,55183,55182,55181,55180,55179,55178,55177,55176,55175,55174,55173,55172,55171,55170,55169,55168,55167,55166,55165,55164,55163,55162,55161,55160,55159,55158,55157,55156,55155,55154,55153,55152,55151,55150,55149,55148,55147,55146,55145,55144,55143,55142,55141,55140,55139,55138,55137,55130,55129,55128,55127,55126,55125,55124,55123,55122,55121,55120,55119,55118,55117,55116,55115,55114,55113,55112,55111,55110,55109,55108,55107,55106,55105,55104,55103,55102,55101,55100,55099,55098,55097,55096,55095,55094,55093,55092,55091,55090,55089,55088,55087,55085,55084,55083,55082,55081,55080,55079,55078,55077,55076,55075,55074,55073,55072,55071,55070,55069,55068,55067,55066,55065,55064,55063,55062,55061,55060,55059,55058,55057,55056,55055,55054,55053,55052,55051,55050,55049,55048,55047,55046,55045,55044,55043,55042,55041,55040,55039,55038,55037,55036,55035,55034,55033,55032,55031,55030,55029,55028,55027,55026,55025,55024,55023,55022,55021,55020,55019,55018,55017,55016,55015,55014,55013,55012,55011,55010,55009,55008,55007,55006,55005,55004,55003,55002,55001,55000,54999,54945,54944,54943,54942,54941,54940,54939,54938,54937,54936,54935,54934,54933,54932,54931,54930,54929,54928,54927,54926,54925,54923,54922,54921,54920,54919,54918,54917,54916,54915,54914,54913,54912,54911,54910,54909,54908,54907,54906,54905,54904,54903,54902,54901,54900,54899,54898,54897,54896,54895,54830,54829,54828,54827,54826,54825,54824,54823,54822,54821,54820,54819,54818,54817,54816,54815,54814,54813,54812,54811,54810,54809,54808,54807,54806,54805,54804,54803,54802,54801,54800,54799,54798,54797,54796,54795,54794,54793,54792,54791,54790,54789,54788,54787,54786,54785,54784,54783,54782,54781,54780,54779,54778,54777,54776,54775,54774,54773,54772,54771,54128,54127,54126,54125,54124,54123,54122,54121,54120,54119,54118,54117,54116,54115,54114,54113,54112,54111,54110,54109,54108,54107,54106,54105,54104,54103,54102,54101,54100,38061,38060,38059,38058,38057,38056,38055,38054,38053,38052,38051,38050,38049,38048,38047,38046,38045,38044,38043,38042,38041,38040,38039,38038,38037,38036,38035,38033,38032,38031,38030,38029,38028,38027,38026,38025,38024,38023,38022,38021,38020,38019,38018,38017,38016,38015,38014,38013,38012,38011,38010,38009,38008,38007,38006,38005,38004,38003,38002,38001,38000,37999,37998,37997,37996,37995,37994,37993,37992,37991,37990,37989,37988,37987,37986,37985,37984,37983,37982,37981,37980,37979,37978,37977,37976,37975,37974,37973,37972,37971,37970,37969,37968,37967,37966,37965,37964,37963,37962,37961,37960,37959,37958,37957,37956,37955,37954,37953,37952,37951,37950,37949,37948,37947,37946,37945,37944,37943,37942,37941,37940,37939,37938,37937,37936,37935,37934,37933,37932,37931,37930,37929,37928,37927,37926,37925,37924,37923,37922,37921,37920,37919,37918,37917,37916,37915,37914,37913,37912,37911,37910,37909,37908,37907,37906,37905,37904,37903,37902,37901,37900,37899,37898,37897,37896,37895,37894,37893,37892,37891,37890,37889,37888,37887,37886,37885,37884,37883,37882,37881,37880,37879,37878,37877,37876,37875,37874,37873,37872,37871,37870,37869,37868,37867,37866,37865,37864,37863,37862,37861,37860,37859,37858,37857,37856,37855,37854,37853,37852,37851,37850,37849,37848,37847,37846,37845,37844,37843,37842,37841,37840,37839,37838,37837,37836,37835,37834,37833,37832,37831,37830,37829,37828,37827,37826,37825,37824,37823,37822,37821,37820,37819,37818,37817,37816,37815,37814,37813,37812,37811,37810,37809,37808,37807,37806,37805,37804,37803,37802,37801,37800,37799,37798,37797,36824,36823,36822,36821,36820,36819,36818,36817,36816,36815,36814,36813,36812,36811,36810,36809,36808,36807,36806,36805,36804,36803,36802,36801,36800,36799,36798,36797,36796,36795,36794,36793,36792,36791,36790,36789,36788,36787,36786,36785,36784,36783,36782,36781,36780,36779,36778,36777,36776,36775,36774,36773,36772,36771,36770,36768,36767,36766,36765,36764,36763,36762,36761,36760,36759,36758,36757,36756,36755,36754,36753,36752,36751,36750,36749,36748,36747,36745,36744,36743,36742,36741,36740,36739,36738,36737,36736,36735,36734,36733,36732,36731,36730,36729,36728,36727,31677,31676,31675,31674,31673,31672,31671,31670,31669,31668,31667,31637,31636,31635,31634,31633,31632,31631,31630,31610,31609,31608,31607,31606,31605,31604,31603,31593,31592,31591,31590,31589,31588,31462,31419,31418,31417,31416,31415,31414,31413,31412,31411,31410,31409,31408,31407,31406,31405,31404,31403,31402,31401,31400,31399,31276,31275,31272,31271,31268,31266,31264,31263,31262,31261,31260,31259,31258,31257,31256,31255,31254,31253,31252,31250,31247,31246,31244,31243,31242,31241,31240,31239,31238,31237,31236,31235,31234,31233,31232,31216,31215,31214,31213,31212,31211,31210,31209,31208,31207,31206,31205,31204,31203,31202,31201,31200,31199,31198,31197,31196,31195,31194,31193,31192,31191,31190,31189,31188,31187,31186,31185,31184,31183,31182,31181,31180,31179,31178,31177,31107,31102,31098,31096,31092,31090,31088,31085,31017,31015,31013,31011,31010,31009,31008,31007,31006,31005,31004,31003,31002,31001,31000,30999,30998,30997,30996,30995,30994,30993,30992,30991,30990,30989,30988,30987,30986,30985,30984,30983,30982,30981,30980,30979,30977,30976,30975,30974,30973,30972,30971,30970,30969,30968,30967,30966,30965,30964,30963,30962,30961,30960,28536,28535,28534,28533,28532,28531,28530,28529,28528,28527,28526,28525,28524,28523,28522,28521,28520,28519,28518,28517,28516,28515,28514,28513,28512,28511,28510,28509,28508,28507,28506,28505,28504,28503,28502,28501,28500,28499,28498,28497,28496,28495,28494,28493,28492,28491,28490,28489,28488,28487,28486,28485,28484,28483,28482,28481,28480,28479,28478,28477,28476,28475,28474,28473,28472,28471,28470,28469,28468,28467,28466,28465,28464,28463,28462,28461,28460,28459,28458,28457,28456,28455,28454,28453,28452,28451,28450,28449,28448,28447,28446,28445,28444,28443,28442,28441,28440,28439,28438,28437,28436,28435,28434,28433,28432,28431,28430,28429,28428,28427,28426,28425,28424,28423,28422,28421,28420,28419,28418,28417,28416,28415,28414,28413,28412,28411,28410,28409,28408,28407,28406,28405,28404,28403,28402,28401,28400,28399,28398,28397,28396,28395,28394,28393,28392,28391,28390,28389,28388,28387,28386,28385,28384,28383,28382,28381,28380,28379,28378,28377,28376,28375,28374,28373,28372,28371,28370,28369,28368,28367,28366,28365,28364,28363,28362,28361,28360,28359,28358,28357,28356,28296,28295,28294,28293,28292,28291,28290,28289,28288,28287,28286,28285,28284,28283,28281,28280,28279,28278,28277,28276,27936,27935,27934,27933,27932,27931,27930,27929,27928,27806,27805,27804,27803,27802,27801,27800,27799,27798,27797,27796,27795,27794,27793,27792,27791,27790,27789,27788,27787,27786,27785,27784,27783,27781,27780,27779,27778,27777,27776,27775,27774,27773,27772,27771,27770,27769,27768,27767,27766,27765,27764,27763,27762,27761,27760,27757,27756,27755,27754,27753,27752,27751,27750,27749,27748,27747,27407,27406,27405,27404,27403,27402,27401,27400,27399,27398,27397,27371,27369,27368,27367,27366,27365,27364,27363,27362,27361,27360,27359,27358,27357,27356,27355,27354,27353,27352,27351,27350,27349,24932,24930,24611,24610,24609,24539,24538,24537,24487,24486,24485,24427,24424,24422,24421,24155,24154,24129,24128,24127,24126,24125,24124,22398,21843,21840,21839,21835,21834,21833,21832,21149,21148,21147,20862,20857,20570,20569,20568,20567,20566,20565,20563,20562,20493,20492,20491,20490,20489,20488,20487,20486,20485,20484,20483,20482,20481,20480,20479,20471,20470,20469,20468,20467,20466,19835,19834,19833,19832,19765,19763,19761,19758,19755,19752,19749,19746,19708,19701,19698,19680,19671,19658,19619,19618,19617,19616,19609,19606,19603,19601,19595,19594,19593,19578,19577,19575,19574,19570,19569,19568,19567,19566,19565,19564,19563,19562,19561,19545,19543,19542,19541,19539,19538,19537,19519,19518,19516,19515,19512,19509,19508,19506,19505,19503,19502,19501,19500,19499,19498,19492,19490,19489,19488,19487,19486,19480,19479,19478,19476,19473,19472,19471,19469,19468,19466,19464,19462,19461,19459,19457,19456,19454,19416,19415,19414,19413,19412,19411,19405,19404,19403,19402,19401,19400,19166,19165,19164,19163,19162,19161,18974,18973,18972,18971,18970,18969,18900,18899,18897,18895,18893,18892,18891,18890,18887,18886,18884,18883,18432,18431,18427,18424,18423,18422,18421,18420,18419,17790,17789,17787,17725,17722,17714,17708,17704,17697,17690,15158,15157,15156,15155,15149,15146,15144,15143,15142,15141,15140,15139,15129,15126,15125,15055,15054,15053,15047,15045,15043,15042,15040,15037,15034,15033,15032,14994,14993,14992,14991,14990,14989,14987,14985,14982,14963,14962,14956,14955,14954,14888,14886,14846,14843,14792,14789,14783,14780,14777,14776,14750,14742,14740,14717,14715,14713,14710,14709,14708,14707,14706,14705,14676,14672,14671,11229,11228,11227,11226,11225,11224,11223,11222,11221,11220,11219,11218,11217,11216,11215,11143,11142,11141,11140,11139,11138,11137,11136,11135,11134,11133,11132,11131,11130,11129,11128,11104,10929,10699,10697,10695,10694,10693,10660,10658,10656,10655,10654,10651,10650,10527,10525,10524,10523,10522,10502,10499,10496,10495,10494,10493,10492,10491,10490,10480,10479,10478,10477,10476,10475,10474,10473,10472,10471,10470,10469,10468,10467,10466,10459,10455,10451,10445,10444,10442,10441,10439,10438,10423,10421,10420,10419,10417,10381,10380,10375,10373,10370,10369,10362,10361,10360,10359,10274,10273,10272,10271,10270,10269,10268,10267,10260,10259,10258,10257,10245,10244,10240,10239,10235,10232,10230,10229,10203,10202,10201,10199,10198,10191,10190,10189,10169,10168,10166,10160,10159,10158,10157,10053,10052,10049,10041,10039,10038,10036,10024,10023,10022,10021,10020,10019,10018,10017,10016,10015,9939,9938,9937,9936,9935,9933,9932,9931,9930,9927,9926,9925,9924,9923,9780,9779,9778,9777,9776,9721,9720,9645,9590,9589,9525,9524,9523,9522,9513,9512,9511,9510,9509,9447,9446,9445,9444,9443,9442,9434,9433,9432,9431,9430,9429,9428,9427,9412,9411,9410,9409,9408,9407,9406,9405,9404,9403,9402,9401,9400,9399,9398,9397,9331,9330,9329,9328,9327,9326,9325,9290,9249,9248,9247,9246,9245,9244,9238,9237,9236,9162,9161,9160,9127,9126,9125,9031,9030,9029,9028,9027,9026,9000,8999,8998,8673,8672,7917,7916,7915,7914,7913,7912,7453,7452,7451,7450,7449,7448,7447,7446,7445,7444,7443,7442,7441,7440,7439,7438,7437,7436,7435,7434,7433,7432,7431,7430,7424,7423,7422,7418,7417,7416,7415,7414,7413,7407,7406,7405,7401,7400,7399,7387,7386,7385,7370,7369,7368,7356,7346,7327,7323,7322,7312,7311,7310,7282,7281,7280,7266,7265,7264,1325,1324,1323,1322,1321,1320,1319,1318,1317,1316,1315,1314,1313,1312,1311,1310,1309,1308,1307,1306,1305,1304,1303,1302,1301,1300,1299,1298,1297,1296,1295,1294,1293,1292,1291,1290,1289,1288);
		$b = array(60052,60051,56963,56962,55996,55838,55314,55256,54803,36764,28509,28469,27806,27362,27361,27358,27357,27355,27353,27351);
		
		$c = array_diff($a, $b);
		print_r(implode(',', $c));exit;
		
		
		$params = $this->params;
		if (empty($this->userId)) {
			throw new $this->exception('登录已过期，请重新登录', array('status' => 2));
		}
		$id = $this->paramFilter('id', 'string');
		if (empty($id)) {
			throw new $this->exception('请求参数错误');
		}
		$projectSv = \service\Project::singleton();
		$dataList = $projectSv->getProjectClipList($this->userId, $id);
		$pageNum = $this->paramFilter('pageNum', 'intval', 1); // 页码
		$pageLimit = $this->paramFilter('pageLimit', 'intval', 20); // 每页数量限制
		// 符合条件的总条数
		$totalNum = count($dataList);
		// 分页显示
		$dataList = array_slice($dataList, ($pageNum - 1) * $pageLimit, $pageLimit);
		return array(
			'totalNum' => $totalNum,
			'list' => array_values($dataList),
		);
	}
	
	/**
	 * 删除成品
	 *
	 * @return array
	 */
	public function deleteProjectClips()
	{
		$params = $this->params;
		if (empty($this->userId)) {
			throw new $this->exception('登录已过期，请重新登录', array('status' => 2));
		}
		$ids = $this->paramFilter('ids', 'array');
		if (empty($ids)) {
			throw new $this->exception('请求参数错误');
		}
		$projectSv = \service\Project::singleton();
		return $projectSv->deleteProjectClips($this->userId, ids);
	}
	
	/**
	 * 生成成片
	 *
	 * @return array
	 */
	public function createProjectClips()
	{
		$params = $this->params;
		if (empty($this->userId)) {
			throw new $this->exception('登录已过期，请重新登录', array('status' => 2));
		}
		$ids =  $this->paramFilter('ids', 'array');
		if (empty($ids)) {
			throw new $this->exception('请求参数错误');
		}
		$projectSv = \service\Project::singleton();
		return $projectSv->createProjectClips($this->userId, $ids);
	}

	/**
	 * 生成成片
	 *
	 * @return array
	 */
	public function createProjectClipsByNum()
	{
		$params = $this->params;
		if (empty($this->userId)) {
			throw new $this->exception('登录已过期，请重新登录', array('status' => 2));
		}
		$id = $this->paramFilter('id', 'string');
		if (empty($id)) {
			throw new $this->exception('请求参数错误');
		}
		$num = $this->paramFilter('num', 'intval');
		if (empty($num)) {
			throw new $this->exception('请求参数错误');
		}
		if ($num > 200) {
			throw new $this->exception('一次最多生成200个');
		}
		$projectSv = \service\Project::singleton();
		return $projectSv->createProjectClipsByNum($this->userId, $id, $num);
	}
	
}